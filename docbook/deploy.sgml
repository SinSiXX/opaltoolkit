<chapter id="deploy" xreflabel="Deploying Applications">
<title>Deploying Applications</title>

<orderedlist>
<listitem>
<para>
Before deploying an Opal web service, you will first need to create a 
configuration file for your application.
</para>

<para>A sample configuration file for the command <command>/bin/date</command>, located
in <filename>$OPAL_HOME/configs/date_config.xml</filename>, is shown below.

<screen>
&lt;appConfig xmlns="http://nbcr.sdsc.edu/opal/types"
           xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
  &lt;metadata&gt;
    &lt;usage&gt;&lt;![CDATA[date [-u] mmddhhmm[[cc]yy]]]&gt;&lt;/usage&gt;
  &lt;/metadata&gt;
  &lt;binaryLocation&gt;/bin/date&lt;/binaryLocation&gt;
  &lt;defaultArgs&gt;&lt;/defaultArgs&gt;
  &lt;jobManagerFQCN&gt;edu.sdsc.nbcr.opal.manager.ForkJobManager&lt;/jobManagerFQCN&gt;
  &lt;parallel&gt;false&lt;/parallel&gt;
&lt;/appConfig&gt;
&lt;/screen&gt;
</screen>
</para>

</listitem>

<listitem>

<para>Deploy the services inside Tomcat, by changing to the $OPAL_HOME
directory, and running the following command:
<screen>
    $ANT_HOME/bin/ant deploy -DserviceName=&lt;serviceName&gt; -DappConfig=&lt;appConfig&gt;
</screen>
</para>

<para>For example, to deploy the Date service, you would type the following
command:
<screen>
    $ANT_HOME/bin/ant deploy -DserviceName=Date \
                 -DappConfig=$PWD/configs/date_config.xml
</screen>
</para>

<para>Note that you can undeploy your service at any time by running the 
following command:
<screen>
    $ANT_HOME/bin/ant undeploy -DserviceName=&lt;serviceName&gt;
</screen>
</para>

<para>Both the deploy and undeploy targets accept a
<filename>-DappVersion</filename> parameter. If this is used, the service
URL deployed is of the form
<filename>serviceName_appVersion</filename>.</para>

<para>If you plan on using the service with large inputs and outputs, it is a
good idea to increase the heap size being used by the JVM. This can be done
by setting the <emphasis role="italics">JAVA_OPTS</emphasis> environment variable to <emphasis role="ital
ics">-Xmx1024m</emphasis>,
and restarting Tomcat. This increases the heap size to 1GB. If all went
well until this step, the services are running and ready to be used. Test
them by running the client, described in the following section.</para>

<para>The service creates new working directories for every execution. These
working directories are not deleted automatically, so they must be
periodically cleaned up. You may use the script
$OPAL_HOME/etc/cleanup.sh to do so - you will have to modify it to point
to your Tomcat installation (and optionally modify the number of days to
retain scratch directories).</para>

</listitem>
</orderedlist>

</chapter>

<chapter id="clientsetup"  xreflabel="Client Set Up Guide">
<title>Command-line Client Installation</title>

<para>Version: &version;</para>

<para>In this chapter we explain how to install Opal command-line
client.</para>

<section id="clientprerequisites" xreflabel="Client Prerequisites">
<title>Prerequisites</title>

<para>
The source distribution can be used to install both the server and the
client sides on Unix and Windows platforms. The client prerequisites form a
subset of the server prerequisites. See <xref
linkend="server-client-pre">.
</para>

</section>

<section id="clientinstall"  xreflabel="Client Installation">
<title>Installation Instructions</title>

<para>Download the Opal2 source distribution from
<ulink type="http"
url="http://sourceforge.net/project/showfiles.php?group_id=211778&amp;package_id=297015">
source forge</ulink>.</para>

<para>Extract the downloaded tarball using the GNU tar utility (or other
similar utilities for Windows), as follows:
<screen>
    tar zxvf opal-ws-$VERSION.tar.gz
</screen>
</para>

<para>This should create a new directory called opal-ws-$VERSION/ where
all the sources are expanded. Henceforth, we refer to this directory as
<emphasis role="italics">OPAL_HOME</emphasis>.</para>

<para>A generic Java client for Opal services is implemented by the
GenericServiceClient class located in $OPAL_HOME/src/edu/sdsc/nbcr/opal. It
lets you run any application exposed as an Opal service, and retrieve its
status and outputs.</para>
<para>To compile the client, run the following command from inside the $OPAL_HOME directory:
<screen>
    $ANT_HOME/bin/ant jar
</screen>
</para>
</section>

<section id="usingclient"  xreflabel="Using Opal Client Programmatically">
<title>Using the Command-line Client</title>

<para>Before running the client, set your classpath using the
etc/classpath.bat|(c)sh script depending on the OS/shell you use - e.g. if you
use tcsh on Unix, set your classpath by typing the following command:
<screen>
    source etc/classpath.sh
</screen>
</para>

<para>To launch a job using the Date service mentioned in
<xref linkend="deploy">, execute the
following command, which displays the resulting job id, along with the preliminary status.
<screen>
    java edu.sdsc.nbcr.opal.GenericServiceClient \
                 -l http://localhost:8080/opal2/services/DateService \
                 -r launchJob \
                 -a \""-v1d -v3m -v0y -v-1d -u"\"
</screen>
</para>
<para>
If your arguments contain characters like "-", you will have to put your
whole set of arguments within quotes that are escaped (\"..\"). If your
arguments don't have special characters you can use regular quotes ("..").
</para>
<para>You can retrieve job status by running the following command:
<screen>
    java edu.sdsc.nbcr.opal.GenericServiceClient \
                 -l http://localhost:8080/opal2/services/DateService \
                 -r queryStatus \
                 -j &lt;job_id&gt;
</screen>
</para>

<para>Once the job has finished executing, you can also retrieve output
metadata using: 
<screen>
    java edu.sdsc.nbcr.opal.GenericServiceClient \
                 -l http://localhost:8080/opal2/services/DateService \
                 -r getOutputs \
                 -j &lt;job_id&gt;
</screen>
</para>

<para>You may need to change the above URL if you used a different port, or
are running the client from another machine. Note that you can get the
complete usage information for the client by using the following command:
<screen>
    java edu.sdsc.nbcr.opal.GenericServiceClient
</screen>
</para>
</section>
</chapter>
